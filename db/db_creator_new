CREATE DATABASE `ir` /*!40100 DEFAULT CHARACTER SET utf8 */;

CREATE TABLE `qrels` (
  `id_collection` int(11) NOT NULL,
  `id_query` varchar(255) NOT NULL,
  `doc_id` varchar(255) NOT NULL,
  `relevant` int(11) DEFAULT '0',
  PRIMARY KEY (`id_collection`,`id_query`,`doc_id`),
  KEY `fk_qrels_2_idx` (`id_query`),
  CONSTRAINT `fk_qrels_1` FOREIGN KEY (`id_collection`) REFERENCES `test_collections` (`id_test_collections`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_qrels_2` FOREIGN KEY (`id_query`) REFERENCES `queries` (`id_query`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `queries` (
  `id_query` varchar(255) NOT NULL,
  `id_collection` int(11) NOT NULL,
  `query_text` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id_query`,`id_collection`),
  KEY `fk_queries_1_idx` (`id_collection`),
  CONSTRAINT `fk_queries_1` FOREIGN KEY (`id_collection`) REFERENCES `test_collections` (`id_test_collections`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `results` (
  `id_run` int(11) NOT NULL,
  `id_query` varchar(255) NOT NULL,
  `doc_id` binary(255) NOT NULL,
  `rank` int(11) DEFAULT NULL,
  `score` double DEFAULT NULL,
  PRIMARY KEY (`id_run`,`id_query`,`doc_id`),
  KEY `fk_results_2_idx` (`id_query`),
  CONSTRAINT `fk_results_2` FOREIGN KEY (`id_query`) REFERENCES `queries` (`id_query`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_results_1` FOREIGN KEY (`id_run`) REFERENCES `runs` (`id_run`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `runs` (
  `id_run` int(11) NOT NULL AUTO_INCREMENT,
  `id_collection` int(11) NOT NULL,
  `name` varchar(45) DEFAULT NULL,
  `privacy` tinyint(1) DEFAULT '0',
  `id_user` int(11) DEFAULT NULL,
  PRIMARY KEY (`id_run`,`id_collection`),
  KEY `fk_runs_1_idx` (`id_collection`),
  CONSTRAINT `fk_runs_1` FOREIGN KEY (`id_collection`) REFERENCES `test_collections` (`id_test_collections`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=4167 DEFAULT CHARSET=utf8;

CREATE TABLE `test_collections` (
  `id_test_collections` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(45) DEFAULT NULL,
  `id_user` int(11) DEFAULT NULL,
  PRIMARY KEY (`id_test_collections`),
  UNIQUE KEY `id_test_collections_UNIQUE` (`id_test_collections`)
) ENGINE=InnoDB AUTO_INCREMENT=146 DEFAULT CHARSET=utf8;


